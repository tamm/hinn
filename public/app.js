angular.module("HinnMed",["ngMaterial","ngMdIcons","oauth2","angularMoment"]).config(["OAuthProvider",function(e){e.configure({baseUrl:"https://api.vasttrafik.se:443",clientId:"Hinn Med",clientKey:"9L4HY9Ofdsg4Q4JIbXY_2ugqVr8a",clientSecret:"NtG5cvDFKasC1NyDtGl9boyRfMYa",grantPath:"/token"})}]).run(["$rootScope","$window","OAuth",function(e,o,t){e.$on("oauth:error",function(e,o){if("invalid_grant"!==o.data.error)return"invalid_token"===o.data.error?t.getRefreshToken():void 0})}]).controller("HinnMedController",["$scope","$http","OAuth","$mdDialog",function(e,o,t,a){var n="https://api.vasttrafik.se/bin/rest.exe/v2",r=(t.isAuthenticated(),t.getAccessToken());e.loading=!0,e.title="Hinn Med",e.$watch("NearbyStops",function(o){if(o){var t=[];o.LocationList.StopLocation.forEach(function(e){e.hasOwnProperty("track")||t.push(e)}),e.nearbystops=t}}),navigator.geolocation.getCurrentPosition(function(o){e.location=o,i()});var i=function(){var t=n+"/location.nearbystops";params={format:"json",originCoordLong:e.location.coords.longitude,originCoordLat:e.location.coords.latitude,maxNo:25},o.get(t,{params:params}).then(function(o){e.NearbyStops=o.data,console.log("nearbystops",e.NearbyStops),e.loading=!1})};r.then(function(){var t=n+"/systeminfo";params={format:"json"},o.get(t,{params:params}).then(function(o){o&&o.data&&o.data.SystemInfo&&(e.SystemInfo=o.data.SystemInfo),console.log("systemInfo",o.data.SystemInfo)})}),e.people=[{name:"tamm"},{name:"tamm2"}],e.showInfo=function(o){console.log("showInfo"),a.show({controller:"HinnMedController",templateUrl:"showInfoDialog.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!0,fullscreen:e.customFullscreen})},e.selectOrigin=function(o){console.log("selectOrigin",o),e.origin=o,s(o.id),e.loading=!0},e.removeOrigin=function(){console.log("removeOrigin"),e.origin=!1,e.departureBoard=!1},e.$watch("departureBoard",function(o){void 0!==o&&o.hasOwnProperty("Departure")?(o.Departure.forEach(function(e){switch(e.style={background:e.fgColor},e.type){case"BUS":isNaN(e.sname)&&(e.icon="directions_bus");break;case"VAS":e.icon="directions_subway";break;case"LDTRAIN":e.icon="directions_train";break;case"REGTRAIN":e.icon="train";break;case"BOAT":e.icon="directions_ferry";break;case"TRAM":e.icon="tram";break;default:e.icon=!1}var o=new Date(e.rtDate+"T"+e.rtTime),t=new Date(e.date+"T"+e.time);e.difference=(t.getTime()-o.getTime())/60/1e3}),e.departures=o.Departure):e.departures=void 0});var s=function(t,a){var r=n+"/departureBoard",i=new Date;params={format:"json",useVas:1,useLDTrain:1,useRegTrain:1,useBus:1,useBoat:1,useTram:1,id:t,date:i.toLocaleDateString("sv-SE").slice(0,10),time:i.toTimeString().slice(0,5)},a&&(params.direction=a),o.get(r,{params:params}).then(function(o){o&&o.data&&o.data.DepartureBoard&&(e.departureBoard=o.data.DepartureBoard),console.log("departureBoard",o.data.DepartureBoard),e.loading=!1})}}]);