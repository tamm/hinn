angular.module("HinnMed",["ngMaterial","ngMdIcons","oauth2","angularMoment"]).config(["OAuthProvider",function(t){t.configure({baseUrl:"https://api.vasttrafik.se:443",clientId:"Hinn Med",clientKey:"9L4HY9Ofdsg4Q4JIbXY_2ugqVr8a",clientSecret:"NtG5cvDFKasC1NyDtGl9boyRfMYa",grantPath:"/token"})}]).run(["$rootScope","$window","OAuth",function(t,o,a){t.$on("oauth:error",function(t,o){if("invalid_grant"!==o.data.error)return"invalid_token"===o.data.error?a.getRefreshToken():void 0})}]).controller("HinnMedController",["$scope","$http","OAuth","$mdDialog",function(t,o,a,n){var e="https://api.vasttrafik.se/bin/rest.exe/v2",r=(a.isAuthenticated(),a.getAccessToken());t.title="Hinn Med",t.$watch("NearbyStops",function(o){if(o){var a=[];o.LocationList.StopLocation.forEach(function(t){t.hasOwnProperty("track")||a.push(t)}),t.nearbystops=a}}),navigator.geolocation.getCurrentPosition(function(o){t.location=o,i()});var i=function(){var a=e+"/location.nearbystops";params={format:"json",originCoordLong:t.location.coords.longitude,originCoordLat:t.location.coords.latitude,maxNo:25},o.get(a,{params:params}).then(function(o){t.NearbyStops=o.data,console.log("nearbystops",t.NearbyStops)})};r.then(function(){var a=e+"/systeminfo";params={format:"json"},o.get(a,{params:params}).then(function(o){o&&o.data&&o.data.SystemInfo&&(t.SystemInfo=o.data.SystemInfo),console.log("systemInfo",o.data.SystemInfo)})}),t.people=[{name:"tamm"},{name:"tamm2"}],t.showInfo=function(o){console.log("showInfo"),n.show({controller:"HinnMedController",templateUrl:"showInfoDialog.html",parent:angular.element(document.body),targetEvent:o,clickOutsideToClose:!0,fullscreen:t.customFullscreen})},t.selectOrigin=function(o){console.log("selectOrigin",o),t.origin=o,s(o.id)};var s=function(a,n){var r=e+"/departureBoard",i=new Date;params={format:"json",useVas:1,useLDTrain:1,useRegTrain:1,useBus:1,useBoat:1,useTram:1,id:a,date:i.toISOString().slice(0,10),time:i.toTimeString().slice(0,5)},n&&(params.direction=n),o.get(r,{params:params}).then(function(o){o&&o.data&&o.data.DepartureBoard&&(t.departureBoard=o.data.DepartureBoard),console.log("departureBoard",o.data.DepartureBoard)})}}]);